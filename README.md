# IM å³æ—¶é€šè®¯ç³»ç»Ÿ

ä¸€ä¸ªå®Œæ•´çš„å³æ—¶é€šè®¯ç³»ç»Ÿï¼ŒåŒ…å« Android å®¢æˆ·ç«¯å’Œ C++ æœåŠ¡ç«¯ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº **C++17 + epoll** çš„é«˜æ€§èƒ½å³æ—¶é€šè®¯æœåŠ¡å™¨ï¼Œé…åˆ **Android (Kotlin)** å®¢æˆ·ç«¯ï¼Œå®ç°å®Œæ•´çš„å³æ—¶é€šè®¯åŠŸèƒ½ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Android å®¢æˆ·ç«¯                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   UIå±‚   â”‚â†’ â”‚ ViewModelâ”‚â†’ â”‚ Repositoryâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â†“                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚  Socket å®¢æˆ·ç«¯   â”‚                  â”‚
â”‚                    â”‚  (TCP è¿æ¥)      â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• TCP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    C++ æœåŠ¡ç«¯                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  epoll   â”‚â†’ â”‚ çº¿ç¨‹æ±    â”‚â†’ â”‚ ä¸šåŠ¡å¤„ç†  â”‚             â”‚
â”‚  â”‚  æœåŠ¡å™¨   â”‚  â”‚          â”‚  â”‚          â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                              â†“                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚   MySQL æ•°æ®åº“   â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± å®¢æˆ·ç«¯åŠŸèƒ½ç‰¹æ€§

- âœ… **ç”¨æˆ·æ³¨å†Œå’Œç™»å½•**
- âœ… **å®æ—¶æ¶ˆæ¯å‘é€å’Œæ¥æ”¶**
- âœ… **å¥½å‹ç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤å¥½å‹
- âœ… **ç¾¤ç»„åŠŸèƒ½**ï¼šåˆ›å»ºç¾¤ç»„ã€ç¾¤èŠ
- âœ… **åœ¨çº¿çŠ¶æ€æ˜¾ç¤º**
- âœ… **æ¶ˆæ¯å†å²è®°å½•**
- âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ Room æ•°æ®åº“æœ¬åœ°å­˜å‚¨

## ğŸ–¥ï¸ æœåŠ¡ç«¯åŠŸèƒ½ç‰¹æ€§

- âœ… **åŸºäº epoll çš„é«˜æ€§èƒ½ I/O å¤šè·¯å¤ç”¨**
- âœ… **çº¿ç¨‹æ± å¤„ç†å¹¶å‘è¯·æ±‚**
- âœ… **MySQL æ•°æ®åº“å­˜å‚¨ç”¨æˆ·å’Œæ¶ˆæ¯æ•°æ®**
- âœ… **ç”¨æˆ·è®¤è¯å’Œåœ¨çº¿çŠ¶æ€ç®¡ç†**
- âœ… **å®æ—¶æ¶ˆæ¯è½¬å‘**ï¼šå•èŠå’Œç¾¤èŠ
- âœ… **å¿ƒè·³æœºåˆ¶ä¿æŒè¿æ¥**
- âœ… **è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®**ï¼šé«˜æ•ˆä¼ è¾“

## ğŸ“ é¡¹ç›®ç»“æ„

```
AndroidIM-/
â”œâ”€â”€ app/                          # Android å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ src/main/java/.../
â”‚   â”‚   â”œâ”€â”€ ui/                   # UI å±‚
â”‚   â”‚   â”œâ”€â”€ viewmodel/            # ViewModel å±‚
â”‚   â”‚   â”œâ”€â”€ repository/           # æ•°æ®ä»“åº“å±‚
â”‚   â”‚   â”œâ”€â”€ network/              # ç½‘ç»œå±‚ï¼ˆSocketï¼‰
â”‚   â”‚   â”œâ”€â”€ protocol/             # åè®®ç¼–è§£ç 
â”‚   â”‚   â”œâ”€â”€ data/                 # æ•°æ®å±‚ï¼ˆRoomï¼‰
â”‚   â”‚   â””â”€â”€ model/                # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ build.gradle.kts
â”œâ”€â”€ server/                       # C++ æœåŠ¡ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.cpp              # ç¨‹åºå…¥å£
â”‚   â”‚   â”œâ”€â”€ server/               # epoll æœåŠ¡å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ epoll_server.h
â”‚   â”‚   â”‚   â””â”€â”€ epoll_server.cpp
â”‚   â”‚   â”œâ”€â”€ thread_pool/          # çº¿ç¨‹æ± 
â”‚   â”‚   â”‚   â”œâ”€â”€ thread_pool.h
â”‚   â”‚   â”‚   â””â”€â”€ thread_pool.cpp
â”‚   â”‚   â”œâ”€â”€ protocol/             # åè®®å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ message.h
â”‚   â”‚   â”‚   â”œâ”€â”€ encoder.h/cpp
â”‚   â”‚   â”‚   â””â”€â”€ decoder.h/cpp
â”‚   â”‚   â”œâ”€â”€ handler/              # ä¸šåŠ¡å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ login_handler.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ message_handler.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ user_handler.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ friend_handler.h/cpp
â”‚   â”‚   â”‚   â””â”€â”€ group_handler.h/cpp
â”‚   â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“è®¿é—®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.h
â”‚   â”‚   â”‚   â””â”€â”€ database.cpp
â”‚   â”‚   â””â”€â”€ utils/                # å·¥å…·ç±»
â”‚   â”‚       â”œâ”€â”€ logger.h
â”‚   â”‚       â””â”€â”€ logger.cpp
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init.sql
â”‚   â”‚   â””â”€â”€ update_add_groups.sql
â”‚   â””â”€â”€ CMakeLists.txt
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®¢æˆ·ç«¯ç¯å¢ƒè¦æ±‚

- **IDE**ï¼šAndroid Studio Hedgehog | 2023.1.1 æˆ–æ›´é«˜ç‰ˆæœ¬
- **JDK**ï¼šJDK 11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Android SDK**ï¼šAPI 24 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Kotlin**ï¼š1.9.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®¢æˆ·ç«¯è¿è¡Œæ­¥éª¤

1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
2. ä½¿ç”¨ Android Studio æ‰“å¼€é¡¹ç›®
3. ç­‰å¾… Gradle åŒæ­¥å®Œæˆ
4. è¿æ¥ Android è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨
5. ç‚¹å‡»è¿è¡ŒæŒ‰é’®

### æœåŠ¡ç«¯ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šLinuxï¼ˆæ¨è Ubuntu 20.04+ï¼‰
- **ç¼–è¯‘å™¨**ï¼šGCC 7.0+ æˆ– Clang 10.0+
- **CMake**ï¼š3.10+
- **C++æ ‡å‡†**ï¼šC++17
- **MySQL**ï¼š5.7+ æˆ– MariaDB 10.3+

### æœåŠ¡ç«¯ç¼–è¯‘å’Œè¿è¡Œ

#### 1. å®‰è£…ä¾èµ–

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install build-essential cmake libmysqlclient-dev

# CentOS/RHEL
sudo yum install gcc-c++ cmake mysql-devel
```

#### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“å’Œè¡¨
mysql -u root -p < server/database/init.sql

# å¦‚æœéœ€è¦ç¾¤ç»„åŠŸèƒ½ï¼Œæ‰§è¡Œæ›´æ–°è„šæœ¬
mysql -u root -p im_server < server/database/update_add_groups.sql
```

#### 3. é…ç½®æ•°æ®åº“è¿æ¥

é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```bash
export DB_HOST=127.0.0.1
export DB_USER=root
export DB_PASSWORD=your_password
export DB_NAME=im_server
export DB_PORT=3306
```

#### 4. ç¼–è¯‘æœåŠ¡ç«¯

```bash
cd server
mkdir build
cd build
cmake ..
make
```

#### 5. è¿è¡ŒæœåŠ¡ç«¯

```bash
# é»˜è®¤ç«¯å£ 8888
./imserver

# æŒ‡å®šç«¯å£
./imserver 9999
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### å®¢æˆ·ç«¯æŠ€æœ¯æ ˆ

- **å¼€å‘è¯­è¨€**ï¼šKotlin
- **æœ€ä½ SDK**ï¼š24 (Android 7.0)
- **ç›®æ ‡ SDK**ï¼š35 (Android 15)
- **æ¶æ„æ¨¡å¼**ï¼šMVVM
- **ä¸»è¦ä¾èµ–**ï¼š
  - AndroidX Core KTX
  - Material Design Components
  - Room Database
  - Kotlin Coroutines
  - Lifecycle & ViewModel

### æœåŠ¡ç«¯æŠ€æœ¯æ ˆ

- **å¼€å‘è¯­è¨€**ï¼šC++17
- **ç½‘ç»œæ¨¡å‹**ï¼šepollï¼ˆLinux I/O å¤šè·¯å¤ç”¨ï¼‰
- **å¹¶å‘æ¨¡å‹**ï¼šçº¿ç¨‹æ±  + äº‹ä»¶é©±åŠ¨
- **æ•°æ®åº“**ï¼šMySQL/MariaDB
- **åè®®**ï¼šè‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®ï¼ˆåŸºäº TCPï¼‰
- **æ„å»ºç³»ç»Ÿ**ï¼šCMake

## ğŸ“¡ é€šä¿¡åè®®

### æ¶ˆæ¯ç±»å‹

- `LOGIN_REQUEST` (0x0001): ç™»å½•è¯·æ±‚
- `LOGIN_RESPONSE` (0x0002): ç™»å½•å“åº”
- `REGISTER_REQUEST` (0x0003): æ³¨å†Œè¯·æ±‚
- `REGISTER_RESPONSE` (0x0004): æ³¨å†Œå“åº”
- `SEND_MESSAGE` (0x0005): å‘é€æ¶ˆæ¯
- `RECEIVE_MESSAGE` (0x0006): æ¥æ”¶æ¶ˆæ¯
- `HEARTBEAT` (0x0007): å¿ƒè·³
- `HEARTBEAT_RESPONSE` (0x0008): å¿ƒè·³å“åº”
- `USER_LIST_REQUEST` (0x0009): ç”¨æˆ·åˆ—è¡¨è¯·æ±‚
- `USER_LIST_RESPONSE` (0x000A): ç”¨æˆ·åˆ—è¡¨å“åº”
- `LOGOUT` (0x000B): ç™»å‡º
- `ERROR` (0x000C): é”™è¯¯æ¶ˆæ¯

### åè®®æ ¼å¼

é‡‡ç”¨è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®ï¼ŒåŒ…å«æ¶ˆæ¯å¤´ï¼ˆç±»å‹ã€é•¿åº¦ï¼‰å’Œæ¶ˆæ¯ä½“ï¼ˆJSON æ ¼å¼çš„æ•°æ®ï¼‰ã€‚

## ğŸ“š æ¶µç›–çš„æŠ€æœ¯çŸ¥è¯†ç‚¹

### å®¢æˆ·ç«¯

- **Activity ç”Ÿå‘½å‘¨æœŸ**
- **MVVM æ¶æ„æ¨¡å¼**
- **Room æ•°æ®åº“**ï¼šæœ¬åœ°æ•°æ®æŒä¹…åŒ–
- **RecyclerView**ï¼šåˆ—è¡¨å±•ç¤º
- **ViewModel**ï¼šUI çŠ¶æ€ç®¡ç†
- **LiveData / StateFlow**ï¼šå“åº”å¼æ•°æ®
- **Kotlin åç¨‹**ï¼šå¼‚æ­¥æ“ä½œ
- **Socket ç¼–ç¨‹**ï¼šTCP ç½‘ç»œé€šä¿¡
- **Material Design ç»„ä»¶**

### æœåŠ¡ç«¯

- **epoll I/O å¤šè·¯å¤ç”¨**ï¼šé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹
- **Reactor æ¨¡å¼**ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„
- **çº¿ç¨‹æ± **ï¼šå¹¶å‘å¤„ç†
- **MySQL C API**ï¼šæ•°æ®åº“æ“ä½œ
- **TCP Socket ç¼–ç¨‹**ï¼šç½‘ç»œé€šä¿¡
- **äºŒè¿›åˆ¶åè®®è®¾è®¡**ï¼šé«˜æ•ˆæ•°æ®ä¼ è¾“
- **ä¿¡å·å¤„ç†**ï¼šä¼˜é›…å…³é—­æœåŠ¡å™¨

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ ç›®çš„ã€‚

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
